<admintpl file="header" />
</head>
<body>
	<div class="wrap js-check-wrap">
		<ul class="nav nav-tabs">
			<li class="active"><a href="{:U('order_return_apply_list')}">换货完成列表</a></li>
		</ul>
		<form class="well form-search" method="post" action="{:U('order_return_apply_list')}">
			换货单编号:
			<input type="text" name="order_sn" style="width: 120px;" value="{$order_sn}" placeholder="换货单编号">&nbsp;
			原来订单编号:
			<input type="text" name="old_order_sn" style="width: 120px;" value="{$old_order_sn}" placeholder="原来订单编号">&nbsp;
			顾客:
			<input type="text" name="customer_name" style="width: 90px;" value="{$customer_name}" placeholder="请输入顾客">&nbsp;
			申请时间：
			<input type="text" name="start_time" class="js-datetime" value="{$start_time|default=''}" style="width: 125px;" placeholder="起始时间" autocomplete="off">-
			<input type="text" class="js-datetime" name="end_time" value="{$end_time|default=''}" style="width: 125px;" placeholder="结束时间" autocomplete="off"> &nbsp;
			<input type="submit" class="btn btn-primary" value="搜索">
		</form>
		<table class="table table-hover table-bordered">
			<thead>
				<tr>
					<th width="16"><label><input type="checkbox" class="js-check-all" data-direction="x" data-checklist="js-check-x"></label></th>
					<th>换货单编号</th>
					<th>原订单编号</th>
					<th>购买数量</th>
					<th>单价</th>
					<th>总价</th>
					<th>顾客</th>
					<th>联系方式</th>
					<th>销售员</th>
					<th>申请时间</th>
					<th>申请状态</th>
					<th width="120">操作</th>
				</tr>
			</thead>
			<tbody>

				<foreach name="list" item="vo">
				<tr>
					<td><input type="checkbox" class="js-check" data-yid="js-check-y" data-xid="js-check-x" name="ids[]" value="{$vo.id}"></td>
					<td>{$vo.order_sn}</td>
					<td>{$vo.old_order_sn}</td>
					<td>
						{$vo.goods_num}
						<if condition="$vo.order_state eq 2">
						    <a  href="javascript:void(0)" onclick="show_detail('{$vo.order_sn}')">[查看详情]</a>
						</if>
					</td>
					<td>{$vo.goods_price}</td>
					<td>{$vo.order_amount}</td>
					<td>{$vo.customer_name}</td>
					<td>
						<switch name="vo.customer_contact_type">
                            <case value="1">微信号:{$vo.customer_contact}</case>
							<case value="2">QQ号:{$vo.customer_contact}</case>
							<case value="3">手机号:{$vo.customer_contact}</case>
						</switch>
					</td>
					<td>{$vo.sales_name}</td>
					<td>{:date('Y-m-d H:i',$vo['create_order_time'])}</td>
					<td>
						<switch name="vo.order_state">
							<case value="-3">换货完成</case>
							<case value="-2">退换申请中</case>
							<case value="-1">申请拒绝</case>
							<case value="1">申请中</case>
							<case value="2">已出货</case>
						</switch>
					</td>
					<td>
						<if condition="sp_auth_check(get_current_admin_id(),'Admin/SellFlow/order_apply_del_post')">
							<if condition="$vo.order_state eq 1">
								<a href="{:U('order_apply_del_post')}/id/{$vo.id}">删除</a>|
							</if>
						</if>
						<!--<if condition="sp_auth_check(get_current_admin_id(),'Admin/SellFlow/order_return_add')">
							<if condition="$vo.order_state eq 2">
								<a href="{:U('order_return_add')}/id/{$vo.id}">申请换货</a>|
							</if>
						</if>-->
					</td>
				</tr>
				</foreach>
			</tbody>
		</table>
		<div class="pagination">{$page}</div>
	</div>
	<script src="__PUBLIC__/js/common.js"></script>
	<script src="__PUBLIC__/js/layer/layer.js"></script>
    <script>
		function toexcel(){
			//勾选导出
			var ids=[];
			$("input[name^='ids']:checked").each(function(i){
				ids[i]=$(this).val();
			});
			var in_str='';
			for(var i=0;i<ids.length;i++){
				if(i!=(ids.length-1)){
					in_str += ids[i]+',';
				}else{
					in_str += ids[i];
				}
			}

			var url = 'momo_regist_toexcel';

				start_time = $("input[name=start_time]").val();
				end_time  = $("input[name=end_time]").val();
				register_username = $("input[name=register_username]").val();
				sell_staus = $('#sell_staus option:selected') .val();
				account_status = $('#account_status option:selected') .val();
				if(start_time){
					url += '/start_time/'+start_time;
				}
				if(end_time){
					url += '/end_time/'+end_time;
				}
				if(register_username){
					url += '/register_username/'+register_username;
				}
				if(sell_staus){
					url += '/sell_staus/'+sell_staus;
				}
				if(account_status){
					url += '/account_status/'+account_status;
				}
			if(in_str){
				url += '/ids/'+in_str;
			}

			window.location.href="{:U('"+url+"')}";
		}
		function change_sell_status(id,status){
			$.ajax({
				data:{id:id,status:status},
				type: "post",
				dataType:"json",
				url:"{:U('momo_regist_edit')}",
				success:function(data){
					if(data.code==-1){
						alert(data.message);
					}else{
						alert(data.message);
						location.reload();
					}
				}
			});
		}
		function show_detail(order_sn){
			layer.open({
				type: 2,
				area: ['600px', '400px'],
				title: '订单详情',
				fixed: false, //不固定
				maxmin: true,
				content: '{:U("SellFlow/order_goods_list")}'+'/order_sn/'+order_sn
			});
		}

	</script>
</body>
</html>