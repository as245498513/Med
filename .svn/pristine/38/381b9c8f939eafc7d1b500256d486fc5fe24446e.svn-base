<admintpl file="header"/>
<style type="text/css">
	.pic-list li {
		margin-bottom: 5px;
	}
</style>
<script type="text/html" id="photos-item-wrapper">
	<li id="savedimage{id}">
		<input id="photo-{id}" type="text" name="photos_url[]" value="{filepath}" style="display:none">
		<input id="photo-{id}-name" type="text" name="photos_alt[]" value="{name}" style="width: 200px;" title="图片名称">
		<img id="photo-{id}-preview" src="{url}" style="height:36px;width: 36px;" onclick="parent.image_preview_dialog(this.src);">
		<a href="javascript:upload_one_image('图片上传','#photo-{id}');">替换</a>
		<a href="javascript:$('#savedimage{id}').remove();">移除</a>
	</li>
</script>
</head>
<body>
	<div class="wrap js-check-wrap">
		<ul class="nav nav-tabs">
			<li><a href="{:U('momentsimgtxt_list')}">朋友圈图文素材</a></li>
			<li class="active">
				<a href="{:U('momentsimgtxt_add')}">
					<if condition="$info.id neq ''">
						编辑
						<else/>
						新增
					</if>
				</a>
			</li>
		</ul>
		<form class="form-horizontal js-ajax-form" action="{:U('Source/momentsimgtxt_add_post')}" method="post">
			<fieldset>
				<div class="control-group">
					<label class="control-label">标题</label>
					<div class="controls">
						<input type="text" name="title" value="{$info.title}" id="title"/>
						<span class="form-required">*</span>
					</div>
				</div>

				<div class="control-group">
					<label class="control-label">内容</label>
					<div class="controls">
						<textarea name="content">{$info.content}</textarea>
						<span class="form-required">*(最多600字)</span>
					</div>
				</div>

				<div class="control-group">
					<label class="control-label">评论</label>
					<div class="controls">
						<textarea name="comments">{$info.comments}</textarea>
						<span class="form-required">(最多900字)</span>
					</div>
				</div>

				<div class="control-group">
					<label class="control-label">素材类别</label>
					<div class="controls">
						<select name="source_class">
						<foreach name="class_list" item="vo">
							<if condition="$vo.id eq $info['source_class_id']">
								<option value="{$vo.id}" selected="selected">{$vo.class_name}</option>
								<else/>
								<option value="{$vo.id}">{$vo.class_name}</option>
							</if>
						</foreach>
						</select>
						<span class="form-required">*</span>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">上传图片</label>
					<div class="controls">
						<div class="input-group">
							 <span class="input-group-btn">
								 <a href="javascript:upload_multi_image('图片上传','#photos','photos-item-wrapper');" class="btn btn-default choosefile">点击浏览</a>
								 <if condition="$info neq ''"><span style="color: red">*点击浏览则重新选择所有图片</span></if>
								 <ul id="photos" class="pic-list unstyled"></ul>
								 <if condition="$info neq ''">
                                     <ul id="photos_edit">
										 <foreach name="info.photo_urls" item="vo" key="k">
											 <li>
												 <input  type="text" name="photos_url[]" value="{$vo}" style="display:none"/>
												 <input  type="text" name="photos_alt[]" value="{$info.photo_alts.$k}" style="width: 250px;" title="图片名称"/><br/>
												 <img style="width: 40%;height: auto" src="{:sp_get_image_url($vo)}">
											 </li>
										 </foreach>
									 </ul>
								 </if>
							 </span>
						</div><!-- /input-group -->
					</div>
				</div>
				<!--隐藏-->
				<input type="text" name="comments_imgtxt_id" value="{$info.id}"  style="display: none"/>
			</fieldset>
			<div class="form-actions">
				<button type="submit" class="btn btn-primary js-ajax-submit">保存</button>
				<a class="btn" href="javascript:history.back(-1);">关闭</a>
			</div>
		</form>
	</div>
	<script src="__PUBLIC__/js/common.js"></script>
	<script src="__PUBLIC__/js/uploadify/jquery.uploadify.min.js" type="text/javascript"></script>
    <script type="text/javascript">
		$(".choosefile").click(function(){
            $("#photos_edit").remove();
		});
	</script>
</body>
</html>