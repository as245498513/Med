<admintpl file="header" />
</head>
<body>
	<div class="wrap js-check-wrap">
		<ul class="nav nav-tabs">
			<li class="active"><a href="{:U('moments_imgtxt_list')}">朋友圈图文发布</a></li>
		</ul>
		<form class="well form-search" method="post" action="{:U('moments_imgtxt_list')}">
			操作时间:
			<input type="text" name="start_time" class="js-datetime" value="{$start_time|default=''}" style="width: 130px;" placeholder="起始时间" autocomplete="off">-
			<input type="text" class="js-datetime" name="end_time" value="{$end_time|default=''}" style="width: 130px;" placeholder="结束时间" autocomplete="off"> &nbsp;

			<input type="submit" class="btn btn-primary" value="搜索">
			<if condition="sp_member_auth_check(sp_get_current_member_id(),'User/task/moments_imgtxt_add')">
			   <a class="btn btn-success" href="{:U('User/task/moments_imgtxt_add')}">新增</a>
			</if>
			<if condition="sp_member_auth_check(sp_get_current_member_id(),'User/task/moments_imgtxt_del_post')">
			 <a class="btn btn-danger " href="javascript:void(0)" onclick="batch_del()">批量删除</a>
			</if>
		</form>
		<table class="table table-hover table-bordered">
			<thead>
				<tr>
					<th width="16"><label><input type="checkbox" class="js-check-all" data-direction="x" data-checklist="js-check-x"></label></th>
					<th width="50">序号</th>
					<th>素材标题</th>
					<th>设备组</th>
					<th>是否提醒好友查看</th>
					<th>是否延时</th>
					<th>计划执行时间</th>
					<th>异步时长(分钟)</th>
					<th>操作时间</th>
					<th width="120">状态</th>
				</tr>
			</thead>
			<tbody>
				<foreach name="list" item="vo">
				<tr>
					<td><input type="checkbox" class="js-check" data-yid="js-check-y" data-xid="js-check-x" name="ids[]" value="{$vo.id}"></td>
					<td>{$vo.id}</td>
					<td title="{$vo.source_list_str}">
						{:mb_strimwidth($vo['source_list_str'],0,30,"...","utf-8")}
					</td>
					<td title="{$vo.device_group_list_str}">
						{:mb_strimwidth($vo['device_group_list_str'],0,30,"...","utf-8")}
					</td>
					<td>
						<switch name="vo.is_remind">
							<case value="0">否</case>
							<case value="1">是</case>
						</switch>
					</td>
					<td>
						<switch name="vo.is_delay">
                            <case value="0">否</case>
							<case value="1">是</case>
						</switch>
					</td>
					<td>{:date("Y-m-d H:i",$vo['plan_time'])}</td>
					<td>{$vo.async}</td>
					<td>{:date("Y-m-d H:i",$vo['createtime'])}</td>
					<td>
						<if condition="sp_member_auth_check(sp_get_current_member_id(),'User/task/moments_imgtxt_edit')">
						  <a href="{:U('moments_imgtxt_edit')}/id/{$vo.id}">编辑</a>|
						</if>
						<if condition="sp_member_auth_check(sp_get_current_member_id(),'User/task/moments_imgtxt_del_post')">
							<a href="javascript:void(0)" onclick="batch_del('{$vo.id}')">删除</a>
						</if>
					</td>
				</tr>
				</foreach>
			</tbody>
		</table>
		<div class="pagination">{$page}</div>
	</div>
	<script src="__PUBLIC__/js/common.js"></script>
	<script src="__PUBLIC__/js/layer/layer.js"></script>
    <script>
	  function batch_del(id){
		  var r=confirm("确定删除吗?");
		  if (r==true){
			  var ids=[];
			  //单个删除
			  if(id){
				  ids[0]=id;
			  }
			  //批量删除
			  $("input[name^='ids']:checked").each(function(i){
				  ids[i]=$(this).val();
			  });
			  $.ajax({
				  data:{ids:ids},
				  type: "post",
				  dataType:"json",
				  url:"{:U('moments_imgtxt_del_post')}",
				  success:function(data){
                      if(data.code==0){
						  alert(data.data+"条数据"+data.message);
						  location.reload();
					  }else{
						  alert(data.message);
					  }
				  }
			  });
		  }
	  }

	</script>
</body>
</html>